@model MicroSocialPlatform.ViewModels.NotificationPageViewModel

@{
    ViewData["Title"] = "Notifications";
}

<div class="container mt-4" style="max-width: 600px;">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 class="fw-light m-0">Notifications</h2>
        @if (Model.Items.Any(i => !i.Notification.IsRead))
        {
            <form asp-action="MarkAllAsRead" method="post">
                <button type="submit" class="btn btn-link text-primary p-0">Mark all as read</button>
            </form>
        }
    </div>

    <div id="notifications-container" class="list-group">
        @if (!Model.Items.Any())
        {
            <div class="text-center py-5" id="empty-state">
                <div class="h1"><i class="bi bi-heart"></i></div>
                <h3>No Notifications Yet</h3>
                <p class="text-muted">When someone follows you or interacts with you, you'll see it here.</p>
            </div>
        }
        else
        {
            @await Html.PartialAsync("_NotificationsPartial", Model)
        }
    </div>

    <div id="notifications-loading" class="text-center py-3" style="display:none;">Loading...</div>
    <div id="notifications-sentinel" style="height: 1px;"></div>
</div>

<script src="~/js/infiniteScroller.js"></script>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        if (!window.MSP || !window.MSP.initInfiniteScroller) return;

        // Only init if we have items (marker will be in the partial)
        @if (Model.Items.Any())
        {
            <text>
            window.MSP.initInfiniteScroller({
                containerId: "notifications-container",
                sentinelId: "notifications-sentinel",
                loadingId: "notifications-loading",
                endpointUrl: "@Url.Action("NotificationsPage", "Notification")",
                pageSize: @Model.PageSize,
                markerClass: "notifications-page-marker"
            });
            </text>
        }
    });
</script>
